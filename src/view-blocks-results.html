<!DOCTYPE html>
<html>

<head>
  <title>thesis questionario view block result</title>
  <meta charset="utf-8">
  <!-- nclblocks-->
  <script src="nclblocks/blockly_compressed.js"></script>
  <script src="nclblocks/blocks_compressed.js"></script>
  <script src="nclblocks/pt-br.js"></script>
  <script src="nclblocks/nclblocks.js"></script>
  <!-- bootstrap-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
  <!-- jquery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js">

  </script>
  <!-- syntaxhighlighter_v3.js -->
  <link type="text/css" rel="stylesheet" href="syntaxhighlighter_v3/shCore.css">
  <link type="text/css" rel="stylesheet" href="syntaxhighlighter_v3/shThemeDefault.css">
  <script type="text/javascript" src="syntaxhighlighter_v3/shCore.js"></script>
  <script type="text/javascript" src="syntaxhighlighter_v3/shBrushXml.js"></script>
  <!-- survey.js -->
  <script src="https://surveyjs.azureedge.net/0.12.7/survey.jquery.min.js"></script>
</head>

<body>
  <div id="content" class="center-block text-center" style="width: 55%">
    resultId=<select id="result_number" type="text" value="0">
    </select>
    <br><br>
    <button id="changes">show changes</button>
    <br><br>
    <script>
      // ---------------------------------------- 
      // survey
      // ---------------------------------------- 
      var inject_div_name = "blockly";
      $('#content').append("<div id='" + inject_div_name + "' style='height: 600px; width: 100%;'></div>");

      NCLBLOCKS_USEBODY = false;
      var startBlocks = "";
      if (NCLBLOCKS_USEBODY) {
        var startBlocks = '<xml id="startBlocks" style="display: none">';
        startBlocks += '<block type="body" inline="false" x="20" y="20"></block>';
        startBlocks += '</xml>';
      }
      Blockly.pathToBlockly = 'nclblocks/'
      Blockly.BlockSvg.START_HAT = true;

      workspace_conceitos_multimodais_task1 = Blockly.inject(inject_div_name, {
        media: Blockly.pathToBlockly + 'media/',
        toolbox: defaultNCLBlocksToolbox,
        scrollbars: true,
        sounds: true
      });
      Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom(startBlocks), workspace_conceitos_multimodais_task1);

      // ---------------------------------------- 
      // request
      // ---------------------------------------- 
      // wget dxsurvey.com/api/MySurveys/getSurveyResults/59bd2657-93ac-492c-8dd5-134a10ebd69a?accessKey=d72526e70b814a3d8f918b60b94dafe4 -O result.json
      var results_data
      $.get("http://dxsurvey.com/api/MySurveys/getSurveyResults/59bd2657-93ac-492c-8dd5-134a10ebd69a?accessKey=d72526e70b814a3d8f918b60b94dafe4", function (data) {
        results_data = data.Data;
        // console.log(results_data);
        for (var i = 0; i < results_data.length; i++) {
          $("<option />").attr("value", i).html(i).appendTo("#result_number");
        }
        $('#result_number').val('0').change();
      });
      $("#result_number").change(function () {
        select_value = parseInt($(this).val());
        // console.log(results_data);
        saved_workspace = results_data[select_value].conceitos_multimodais_blocks1_inserted;
        workspace_conceitos_multimodais_task1.clear();
        Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom(saved_workspace), workspace_conceitos_multimodais_task1);
      });

      // ---------------------------------------- 
      // show changes button
      // ---------------------------------------- 

      var run_event_interval_index = 0;
      var run_event_interval = function (index) {
        result = JSON.parse(results_data[index].conceitos_multimodais_blocks1_changes);
        if (run_event_interval_index >= result.changes.length) {
          clearInterval(run_event_interval);
          return;
        }
        json = result.changes[run_event_interval_index];
        // console.log(json);
        // console.log(run_event_interval_index);
        event = Blockly.Events.fromJson(json, workspace_conceitos_multimodais_task1);
        event.run(true);
        run_event_interval_index++;
      }

      $("#changes").click(function () {
        if (results_data == null) return;
        index = parseInt(($("#result_number option:selected").val()));
        workspace_conceitos_multimodais_task1.clear();
        setInterval(run_event_interval, 200, index);
      });
    </script>
  </div>
</body>

</html>